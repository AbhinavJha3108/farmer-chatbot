<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farmer AI Chatbot - Enhanced Offline</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .chat-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
            height: 80vh;
            max-height: 700px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .chat-header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .chat-header h1 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }
        
        .chat-header p {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f9f9f9;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 80%;
            word-wrap: break-word;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            background: #007bff;
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }
        
        .bot-message {
            background: white;
            color: #333;
            border: 1px solid #e0e0e0;
            border-bottom-left-radius: 4px;
        }
        
        .chat-input {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
        }
        
        #messageInput {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }
        
        #messageInput:focus {
            border-color: #4CAF50;
        }
        
        #sendButton {
            padding: 12px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
            min-width: 60px;
        }
        
        #sendButton:hover {
            background: #45a049;
        }
        
        #sendButton:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 10px;
            color: #666;
            font-style: italic;
        }
        
        .typing-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #666;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }
        
        .offline-indicator {
            background: #ff9800;
            color: white;
            padding: 8px;
            text-align: center;
            font-size: 0.9em;
            display: none;
        }
        
        .quick-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .quick-action {
            background: #e3f2fd;
            color: #1976d2;
            border: 1px solid #bbdefb;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .quick-action:hover {
            background: #bbdefb;
            transform: translateY(-1px);
        }
        
        @media (max-width: 600px) {
            .chat-container {
                height: 100vh;
                max-height: 100vh;
                border-radius: 0;
            }
            
            body {
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>üåæ Farmer AI Assistant</h1>
            <p>Your complete farming guide - Works Offline!</p>
        </div>
        
        <div class="offline-indicator" id="offlineIndicator">
            üå± Offline Mode - Using local farming knowledge
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <div class="message bot-message">
                üëã Hello! I'm your comprehensive farming assistant. I can help you with crops, soil, weather, pests, organic farming, irrigation, and much more! Try asking me anything about farming. I work completely offline!
            </div>
            <div class="quick-actions">
                <div class="quick-action" onclick="askQuestion('What crops grow best in sandy soil?')">üèñÔ∏è Sandy Soil</div>
                <div class="quick-action" onclick="askQuestion('How to start organic farming?')">üåø Organic Farming</div>
                <div class="quick-action" onclick="askQuestion('Best fertilizer for tomatoes?')">üçÖ Tomato Care</div>
                <div class="quick-action" onclick="askQuestion('Pest control for vegetables?')">üêõ Pest Control</div>
            </div>
        </div>
        
        <div class="loading" id="loading">
            <div class="typing-indicator">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>
        
        <div class="chat-input">
            <input type="text" id="messageInput" placeholder="Ask any farming question..." />
            <button id="sendButton">Send</button>
        </div>
    </div>

    <script>
        // Comprehensive farming knowledge base
        const farmingKnowledge = {
            // SOIL TYPES - DETAILED
            'sandy soil': {
                response: "üèñÔ∏è **Sandy Soil Guide:**\n\n**Best Crops:**\n‚Ä¢ Root vegetables: Carrots, radishes, potatoes, sweet potatoes\n‚Ä¢ Melons: Watermelons, cantaloupes\n‚Ä¢ Vegetables: Lettuce, corn, asparagus\n‚Ä¢ Herbs: Rosemary, thyme, oregano\n\n**Soil Improvement:**\n‚Ä¢ Add 4-6 inches of compost annually\n‚Ä¢ Use cover crops like clover or rye\n‚Ä¢ Mulch heavily to retain moisture\n‚Ä¢ Avoid over-fertilizing - nutrients leach quickly\n\n**Water Management:**\n‚Ä¢ Water deeply but infrequently\n‚Ä¢ Use drip irrigation for efficiency\n‚Ä¢ Water early morning to reduce evaporation",
                keywords: ['sandy', 'sand', 'drains quickly', 'well-draining']
            },
            
            'clay soil': {
                response: "üü´ **Clay Soil Guide:**\n\n**Best Crops:**\n‚Ä¢ Leafy greens: Broccoli, cabbage, Brussels sprouts, kale\n‚Ä¢ Root crops: Beets, turnips (short varieties)\n‚Ä¢ Legumes: Beans, peas\n‚Ä¢ Fruits: Apples, pears, berries\n\n**Soil Improvement:**\n‚Ä¢ Add gypsum to break up clay particles\n‚Ä¢ Mix in 2-3 inches of compost yearly\n‚Ä¢ Use raised beds for better drainage\n‚Ä¢ Avoid working when wet - causes compaction\n\n**Planting Tips:**\n‚Ä¢ Plant seeds shallower than recommended\n‚Ä¢ Space plants further apart for air circulation\n‚Ä¢ Consider container gardening for better control",
                keywords: ['clay', 'heavy', 'compacted', 'waterlogged', 'poor drainage']
            },
            
            'silty soil': {
                response: "üü® **Silty Soil Guide:**\n\n**Best Crops:**\n‚Ä¢ Grains: Wheat, rice, barley, oats\n‚Ä¢ Vegetables: Tomatoes, lettuce, cabbage, cucumbers\n‚Ä¢ Root crops: Carrots, potatoes, onions\n‚Ä¢ Fruits: Most fruit trees thrive\n\n**Advantages:**\n‚Ä¢ Excellent moisture retention\n‚Ä¢ Naturally fertile\n‚Ä¢ Good drainage without drying out\n‚Ä¢ Easy to work with\n\n**Management:**\n‚Ä¢ Add organic matter yearly\n‚Ä¢ Use mulch to prevent erosion\n‚Ä¢ Avoid over-tilling - can become compacted\n‚Ä¢ Perfect for both conventional and organic farming",
                keywords: ['silty', 'silt', 'fertile', 'moisture retention']
            },
            
            // CROP SPECIFIC - COMPREHENSIVE
            'wheat': {
                response: "üåæ **Complete Wheat Growing Guide:**\n\n**Planting:**\n‚Ä¢ Time: Fall (Sept-Oct) for winter wheat, Spring (Mar-Apr) for spring wheat\n‚Ä¢ Depth: 1-2 inches deep\n‚Ä¢ Spacing: 6-8 inches between rows\n‚Ä¢ Soil temp: 45-65¬∞F for germination\n\n**Water Requirements:**\n‚Ä¢ Total: 20-25 inches per season\n‚Ä¢ Critical stages: Booting, flowering, grain fill\n‚Ä¢ Method: Drip or flood irrigation\n\n**Fertilizer:**\n‚Ä¢ Nitrogen: 60-90 lbs/acre (split application)\n‚Ä¢ Phosphorus: Based on soil test\n‚Ä¢ Potassium: 40-60 lbs/acre\n‚Ä¢ Timing: Half at planting, half at tillering\n\n**Harvest:**\n‚Ä¢ Timing: When kernels are hard and golden\n‚Ä¢ Moisture: 13-14% for storage\n‚Ä¢ Yield: 40-80 bushels/acre depending on variety\n\n**Common Problems:**\n‚Ä¢ Rust: Use resistant varieties, fungicide if needed\n‚Ä¢ Aphids: Monitor in spring, beneficial insects help\n‚Ä¢ Wheat streak mosaic: Control wheat curl mites",
                keywords: ['wheat', 'grain', 'cereal']
            },
            
            'rice': {
                response: "üåæ **Complete Rice Growing Guide:**\n\n**Planting Methods:**\n‚Ä¢ Traditional: Direct seeding in flooded fields\n‚Ä¢ SRI (System of Rice Intensification): Transplanting seedlings\n‚Ä¢ Seed rate: 80-100 kg/ha for direct seeding\n\n**Water Management:**\n‚Ä¢ Maintain 2-4 inches standing water\n‚Ä¢ Drain before harvest (2 weeks prior)\n‚Ä¢ Critical stages: Tillering, flowering\n‚Ä¢ Total water: 1000-2000 mm per season\n\n**Fertilizer:**\n‚Ä¢ Nitrogen: 100-150 kg/ha (3 split applications)\n‚Ä¢ Phosphorus: 40-60 kg/ha at planting\n‚Ä¢ Potassium: 30-50 kg/ha\n‚Ä¢ Zinc: Important for rice - 25 kg/ha if deficient\n\n**Spacing (SRI Method):**\n‚Ä¢ Traditional: 20x20 cm\n‚Ä¢ SRI: 25x25 cm with single seedling\n‚Ä¢ Benefits: 30-50% higher yields, less water\n\n**Harvest:**\n‚Ä¢ Timing: 80-120 days after planting\n‚Ä¢ Indicators: 80% grains golden, moisture 20-22%\n‚Ä¢ Yield: 4-6 tons/ha traditional, 6-8 tons/ha SRI",
                keywords: ['rice', 'paddy', 'water management']
            },
            
            'corn': {
                response: "üåΩ **Complete Corn Growing Guide:**\n\n**Planting:**\n‚Ä¢ Time: Spring when soil reaches 60¬∞F\n‚Ä¢ Depth: 1.5-2 inches deep\n‚Ä¢ Spacing: 30 inches between rows, 6-12 inches between plants\n‚Ä¢ Population: 25,000-35,000 plants/acre\n\n**Water Needs:**\n‚Ä¢ Total: 20-30 inches per season\n‚Ä¢ Critical: Tasseling and silking stages\n‚Ä¢ Method: Drip irrigation most efficient\n‚Ä¢ Frequency: 1-1.5 inches per week\n\n**Fertilizer:**\n‚Ä¢ Nitrogen: 150-200 lbs/acre\n‚Ä¢ Phosphorus: 50-80 lbs/acre at planting\n‚Ä¢ Potassium: 100-150 lbs/acre\n‚Ä¢ Timing: Side-dress nitrogen when plants are knee-high\n\n**Pest Management:**\n‚Ä¢ Corn borer: Use Bt corn or monitor with traps\n‚Ä¢ Earworm: Apply beneficial insects\n‚Ä¢ Cutworm: Use collars on seedlings\n‚Ä¢ Weeds: Pre-emergent herbicides or cultivation\n\n**Harvest:**\n‚Ä¢ Timing: When husks are dry and kernels are dented\n‚Ä¢ Moisture: 15.5% for storage\n‚Ä¢ Yield: 150-200 bushels/acre (irrigated)",
                keywords: ['corn', 'maize', 'sweet corn']
            },
            
            'tomato': {
                response: "üçÖ **Complete Tomato Growing Guide:**\n\n**Planting:**\n‚Ä¢ Time: After last frost, soil 70¬∞F+\n‚Ä¢ Spacing: 24-36 inches apart, 36-48 inches between rows\n‚Ä¢ Depth: Plant deep, up to first leaves\n‚Ä¢ Support: Cages, stakes, or trellises\n\n**Water Requirements:**\n‚Ä¢ Amount: 1-2 inches per week\n‚Ä¢ Method: Drip irrigation at base\n‚Ä¢ Frequency: Deep watering, avoid wetting leaves\n‚Ä¢ Mulch: 2-3 inches to conserve moisture\n\n**Fertilizer:**\n‚Ä¢ NPK ratio: Balanced 10-10-10 or 5-10-10\n‚Ä¢ Timing: At planting, flowering, and fruit set\n‚Ä¢ Amount: 2-3 lbs per 100 sq ft per season\n‚Ä¢ Organic: Compost, fish emulsion, bone meal\n\n**Common Problems:**\n‚Ä¢ Blossom end rot: Calcium deficiency, consistent watering\n‚Ä¢ Hornworms: Hand-pick or use Bt\n‚Ä¢ Early blight: Remove affected leaves, copper spray\n‚Ä¢ Aphids: Insecticidal soap, beneficial insects\n\n**Harvest:**\n‚Ä¢ Timing: Fully colored but still firm\n‚Ä¢ Storage: Room temperature, not in refrigerator\n‚Ä¢ Yield: 10-20 lbs per plant depending on variety",
                keywords: ['tomato', 'tomatoes']
            },
            
            // ORGANIC FARMING
            'organic farming': {
                response: "üåø **Complete Organic Farming Guide:**\n\n**Basic Principles:**\n‚Ä¢ No synthetic pesticides or fertilizers\n‚Ä¢ Focus on soil health and biodiversity\n‚Ä¢ Crop rotation and diversity\n‚Ä¢ Natural pest management\n\n**Soil Management:**\n‚Ä¢ Compost: 2-3 inches annually\n‚Ä¢ Cover crops: Clover, vetch, rye in off-season\n‚Ä¢ Green manures: Turn under before flowering\n‚Ä¢ Minimum tillage: Preserve soil structure\n\n**Pest Control:**\n‚Ä¢ Prevention: Crop rotation, resistant varieties\n‚Ä¢ Biological: Ladybugs, lacewings, beneficial nematodes\n‚Ä¢ Physical: Row covers, traps, hand-picking\n‚Ä¢ Botanical: Neem oil, pyrethrin, insecticidal soap\n\n**Weed Management:**\n‚Ä¢ Prevention: Mulch, cover crops, proper spacing\n‚Ä¢ Mechanical: Hoeing, cultivation, flame weeding\n‚Ä¢ Cultural: Crop rotation, competitive planting\n\n**Certification Process:**\n‚Ä¢ Transition period: 3 years\n‚Ä¢ Record keeping: Detailed farming practices\n‚Ä¢ Inspection: Annual certification review\n‚Ä¢ Benefits: Premium prices, environmental stewardship\n\n**Getting Started:**\n1. Test soil and improve with organic matter\n2. Plan crop rotation schedule\n3. Source organic seeds and inputs\n4. Develop pest monitoring system\n5. Keep detailed records from day 1",
                keywords: ['organic', 'natural farming', 'chemical-free']
            },
            
            // IRRIGATION
            'irrigation': {
                response: "üíß **Complete Irrigation Guide:**\n\n**Drip Irrigation (Most Efficient):**\n‚Ä¢ Efficiency: 90-95%\n‚Ä¢ Best for: Row crops, vegetables, orchards\n‚Ä¢ Benefits: Less weeds, disease prevention\n‚Ä¢ Cost: $500-1500 per acre initial setup\n\n**Sprinkler Irrigation:**\n‚Ä¢ Efficiency: 70-80%\n‚Ä¢ Best for: Pastures, lawns, field crops\n‚Ä¢ Types: Center pivot, traveling gun, solid set\n‚Ä¢ Pressure: 40-60 PSI typical\n\n**Flood Irrigation:**\n‚Ä¢ Efficiency: 40-50%\n‚Ä¢ Best for: Rice, level fields\n‚Ä¢ Method: Border, basin, furrow irrigation\n‚Ä¢ Labor: High maintenance requirement\n\n**Scheduling Guidelines:**\n‚Ä¢ Vegetables: 1-1.5 inches per week\n‚Ä¢ Field crops: 1-2 inches per week\n‚Ä¢ Orchards: 2-3 inches per week\n‚Ä¢ Timing: Early morning or late evening\n\n**Water Quality:**\n‚Ä¢ pH: 6.5-8.0 ideal\n‚Ä¢ EC: Less than 3 dS/m for most crops\n‚Ä¢ Filtration: Remove particles > 50 microns\n‚Ä¢ Testing: Annually for contaminants\n\n**Conservation Tips:**\n‚Ä¢ Use soil moisture sensors\n‚Ä¢ Implement deficit irrigation strategies\n‚Ä¢ Capture and reuse runoff water\n‚Ä¢ Maintain irrigation equipment regularly",
                keywords: ['irrigation', 'watering', 'water management']
            },
            
            // PEST MANAGEMENT
            'pest control': {
                response: "üêõ **Integrated Pest Management (IPM) Guide:**\n\n**1. Prevention (First Line):**\n‚Ä¢ Crop rotation: Break pest cycles\n‚Ä¢ Resistant varieties: Choose adapted cultivars\n‚Ä¢ Proper spacing: Good air circulation\n‚Ä¢ Sanitation: Remove crop debris\n\n**2. Monitoring:**\n‚Ä¢ Scouting: Weekly field inspections\n‚Ä¢ Traps: Pheromone, sticky, light traps\n‚Ä¢ Thresholds: Economic injury levels\n‚Ä¢ Records: Track pest patterns yearly\n\n**3. Biological Controls:**\n‚Ä¢ Ladybugs: Aphids, mealybugs, scale insects\n‚Ä¢ Lacewings: Aphids, whiteflies, thrips\n‚Ä¢ Praying mantis: Most garden pests\n‚Ä¢ Beneficial nematodes: Soil-dwelling pests\n\n**4. Mechanical Controls:**\n‚Ä¢ Hand-picking: Large insects like hornworms\n‚Ä¢ Traps: Color, pheromone, light traps\n‚Ä¢ Barriers: Row covers, netting\n‚Ä¢ Tillage: Expose soil pests to predators\n\n**5. Chemical Controls (Last Resort):**\n‚Ä¢ Organic options: Neem oil, Bt, pyrethrin\n‚Ä¢ Synthetic: Use least toxic options\n‚Ä¢ Timing: Apply when pests are most vulnerable\n‚Ä¢ Resistance: Rotate chemical classes\n\n**Common Pests by Crop:**\n‚Ä¢ Tomatoes: Hornworms, aphids, whiteflies\n‚Ä¢ Corn: Corn borers, earworms, cutworms\n‚Ä¢ Cabbage: Cabbage worms, aphids, flea beetles\n‚Ä¢ Squash: Squash bugs, vine borers, cucumber beetles",
                keywords: ['pest', 'insect', 'bug', 'aphid', 'hornworm']
            },
            
            // FERTILIZER
            'fertilizer': {
                response: "üå± **Complete Fertilizer Guide:**\n\n**Understanding NPK:**\n‚Ä¢ Nitrogen (N): Leaf growth, green color\n‚Ä¢ Phosphorus (P): Root development, flowering\n‚Ä¢ Potassium (K): Fruit quality, disease resistance\n\n**Application Timing:**\n‚Ä¢ Pre-plant: Based on soil test recommendations\n‚Ä¢ At planting: Starter fertilizer for seedlings\n‚Ä¢ Growing season: Split applications for efficiency\n‚Ä¢ Post-harvest: Cover crops for next season\n\n**Crop-Specific Needs:**\n‚Ä¢ Corn: High nitrogen (150-200 lbs/acre)\n‚Ä¢ Wheat: Moderate nitrogen (60-90 lbs/acre)\n‚Ä¢ Tomatoes: Balanced NPK (10-10-10)\n‚Ä¢ Leafy greens: High nitrogen for growth\n\n**Organic Options:**\n‚Ä¢ Compost: 2-3 inches annually\n‚Ä¢ Manure: Well-aged, 20-40 lbs per 1000 sq ft\n‚Ä¢ Bone meal: Phosphorus source\n‚Ä¢ Blood meal: High nitrogen content\n‚Ä¢ Green sand: Potassium and micronutrients\n\n**Application Methods:**\n‚Ä¢ Broadcast: Even coverage before planting\n‚Ä¢ Band: Concentrated near seed row\n‚Ä¢ Side-dress: During growing season\n‚Ä¢ Fertigation: Through irrigation system\n\n**Safety Precautions:**\n‚Ä¢ Soil test: Every 2-3 years\n‚Ä¢ pH management: 6.0-7.0 optimal\n‚Ä¢ Water quality: Prevent nutrient lock-up\n‚Ä¢ Environmental: Prevent runoff to waterways",
                keywords: ['fertilizer', 'nutrients', 'npk', 'feeding']
            },
            
            // WEATHER
            'weather': {
                response: "üå§Ô∏è **Weather-Smart Farming Guide:**\n\n**Frost Protection:**\n‚Ä¢ Cover crops: Blankets, row covers, hot caps\n‚Ä¢ Water: Sprinkle plants before sunrise (releases heat)\n‚Ä¢ Wind machines: Mix warm air with cold air\n‚Ä¢ Site selection: Avoid low-lying areas\n\n**Drought Management:**\n‚Ä¢ Crops: Sorghum, millets, cowpeas, tepary beans\n‚Ä¢ Practices: Conservation tillage, mulching\n‚Ä¢ Irrigation: Drip systems, timing adjustments\n‚Ä¢ Soil: Organic matter to hold moisture\n\n**Heat Stress:**\n‚Ä¢ Timing: Earlier/later planting dates\n‚Ä¢ Shade: Shade nets for sensitive crops\n‚Ä¢ Water: Deep, infrequent irrigation\n‚Ä¢ Varieties: Heat-tolerant cultivars\n\n**Rain Management:**\n‚Ä¢ Drainage: Raised beds, contour farming\n‚Ä¢ Cover crops: Prevent erosion\n‚Ä¢ Timing: Avoid field work when wet\n‚Ä¢ Structures: Grassed waterways, terraces\n\n**Seasonal Planning:**\n‚Ä¢ Spring: Watch soil temperature, frost dates\n‚Ä¢ Summer: Heat protection, irrigation scheduling\n‚Ä¢ Fall: Harvest timing, winter preparation\n‚Ä¢ Winter: Cover crops, equipment maintenance\n\n**Climate Adaptation:**\n‚Ä¢ Diversify: Multiple crop varieties\n‚Ä¢ Flexible: Adjustable planting schedules\n‚Ä¢ Resilient: Soil health focus\n‚Ä¢ Informed: Weather monitoring services",
                keywords: ['weather', 'climate', 'frost', 'drought', 'rain']
            },
            
            // CROP ROTATION
            'crop rotation': {
                response: "üîÑ **Complete Crop Rotation Guide:**\n\n**Benefits:**\n‚Ä¢ Pest control: Breaks insect and disease cycles\n‚Ä¢ Soil health: Different root depths and nutrients\n‚Ä¢ Weed management: Different life cycles\n‚Ä¢ Yield increase: Up to 20% higher yields\n\n**4-Year Rotation Example:**\n‚Ä¢ Year 1: Corn (heavy feeder)\n‚Ä¢ Year 2: Soybeans (nitrogen fixer)\n‚Ä¢ Year 3: Wheat (moderate feeder)\n‚Ä¢ Year 4: Alfalfa (soil builder)\n\n**Vegetable Garden Rotation:**\n‚Ä¢ Legumes ‚Üí Brassicas ‚Üí Alliums ‚Üí Solanaceae\n‚Ä¢ Beans ‚Üí Cabbage ‚Üí Onions ‚Üí Tomatoes\n‚Ä¢ Peas ‚Üí Broccoli ‚Üí Garlic ‚Üí Peppers\n\n**Rotation Principles:**\n‚Ä¢ Follow heavy feeders with light feeders\n‚Ä¢ Include nitrogen-fixing legumes\n‚Ä¢ Use deep-rooted then shallow-rooted crops\n‚Ä¢ Avoid same family crops consecutively\n\n**Family Groups:**\n‚Ä¢ Solanaceae: Tomatoes, peppers, potatoes, eggplant\n‚Ä¢ Brassicaceae: Cabbage, broccoli, cauliflower, kale\n‚Ä¢ Leguminosae: Beans, peas, lentils, alfalfa\n‚Ä¢ Alliaceae: Onions, garlic, leeks\n‚Ä¢ Cucurbitaceae: Squash, cucumbers, melons\n\n**Advanced Techniques:**\n‚Ä¢ Cover crops: Between cash crops\n‚Ä¢ Double cropping: Two crops per season\n‚Ä¢ Strip cropping: Alternating strips\n‚Ä¢ Relay planting: Overlapping seasons",
                keywords: ['rotation', 'rotate crops', 'crop sequence']
            },
            
            // COMPANION PLANTING
            'companion planting': {
                response: "üåø **Complete Companion Planting Guide:**\n\n**Classic Combinations:**\n\n**Three Sisters (Native American):**\n‚Ä¢ Corn: Provides support for beans\n‚Ä¢ Beans: Fix nitrogen for corn and squash\n‚Ä¢ Squash: Shades soil, deters pests\n\n**Tomato Companions:**\n‚Ä¢ Basil: Repels hornworms and aphids\n‚Ä¢ Marigolds: Deter nematodes\n‚Ä¢ Carrots: Good neighbors, different root depths\n‚Ä¢ Borage: Attracts beneficial insects\n\n**Cabbage Family Companions:**\n‚Ä¢ Dill: Attracts beneficial insects\n‚Ä¢ Mint: Deters cabbage moths\n‚Ä¢ Rosemary: Repels cabbage butterflies\n‚Ä¢ Onions: Deter carrot rust flies\n\n**Bad Combinations (Avoid):**\n‚Ä¢ Tomatoes + Potatoes: Both susceptible to blight\n‚Ä¢ Beans + Onions: Onions inhibit bean growth\n‚Ä¢ Cabbage + Grapes: Grapes stunt cabbage growth\n‚Ä¢ Sunflowers + Potatoes: Sunflowers are allelopathic\n\n**Benefits of Companion Planting:**\n‚Ä¢ Pest control: Natural repellent properties\n‚Ä¢ Nutrient sharing: Different nutrient needs\n‚Ä¢ Space efficiency: Vertical growing\n‚Ä¢ Biodiversity: Attracts beneficial insects\n\n**Planning Tips:**\n‚Ä¢ Consider plant heights and sun needs\n‚Ä¢ Research specific variety interactions\n‚Ä¢ Observe and adjust based on results\n‚Ä¢ Keep records of successful combinations",
                keywords: ['companion', 'plant together', 'good neighbors']
            }
        };

        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const loading = document.getElementById('loading');
        const offlineIndicator = document.getElementById('offlineIndicator');

        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
            messageDiv.innerHTML = content.replace(/\n/g, '<br>');
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function askQuestion(question) {
            messageInput.value = question;
            sendMessage();
        }

        function getSmartResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Check for exact matches first
            for (const [key, data] of Object.entries(farmingKnowledge)) {
                if (lowerMessage.includes(key)) {
                    return data.response;
                }
            }
            
            // Check for keyword matches
            for (const [key, data] of Object.entries(farmingKnowledge)) {
                if (data.keywords && data.keywords.some(keyword => lowerMessage.includes(keyword))) {
                    return data.response;
                }
            }
            
            // Check for general farming keywords
            const farmingKeywords = [
                'crop', 'soil', 'farm', 'agriculture', 'irrigation', 'fertilizer', 
                'pesticide', 'harvest', 'planting', 'seeds', 'weather', 'rainfall',
                'drought', 'pest', 'disease', 'yield', 'cultivation', 'farming',
                'tractor', 'plow', 'organic', 'greenhouse', 'livestock', 'cattle',
                'milk', 'poultry', 'fish', 'rice', 'wheat', 'corn', 'vegetables',
                'fruits', 'sugarcane', 'cotton', 'tea', 'coffee', 'spices', 'water',
                'grow', 'plant', 'seed', 'garden', 'field'
            ];
            
            const isFarmingRelated = farmingKeywords.some(keyword => lowerMessage.includes(keyword));
            
            if (!isFarmingRelated) {
                return "üö´ I specialize in farming and agriculture topics only. Please ask me about crops, soil, weather, farming techniques, organic farming, pest control, irrigation, or other agricultural subjects. I'm here to help with all your farming questions!";
            }
            
            // Enhanced default response with suggestions
            return "üå± **Great farming question!** Here are some topics I can help you with in detail:\n\n**üìä Soil Types:**\n‚Ä¢ Sandy soil crops and management\n‚Ä¢ Clay soil improvement techniques\n‚Ä¢ Silty soil advantages and crops\n\n**üåæ Crop Guides:**\n‚Ä¢ Wheat, rice, corn complete growing instructions\n‚Ä¢ Tomato, vegetable care\n‚Ä¢ Planting, harvesting, yields\n\n**üåø Farming Practices:**\n‚Ä¢ Organic farming complete guide\n‚Ä¢ Crop rotation planning\n‚Ä¢ Companion planting combinations\n\n**üíß Management:**\n‚Ä¢ Irrigation systems and scheduling\n‚Ä¢ Pest control (IPM)\n‚Ä¢ Fertilizer application\n‚Ä¢ Weather protection\n\n**Try asking about any of these topics, or be more specific about your farming situation!**";
        }

        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            addMessage(message, true);
            messageInput.value = '';
            loading.style.display = 'block';
            sendButton.disabled = true;

            try {
                // Simulate thinking time for better UX
                await new Promise(resolve => setTimeout(resolve, 800));
                
                const reply = getSmartResponse(message);
                addMessage(reply);
                
                // Show offline indicator briefly
                offlineIndicator.style.display = 'block';
                setTimeout(() => {
                    offlineIndicator.style.display = 'none';
                }, 2000);
                
            } catch (error) {
                addMessage('‚ùå Sorry, I encountered an error. Please try again.');
            } finally {
                loading.style.display = 'none';
                sendButton.disabled = false;
            }
        }

        sendButton.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Check online status
        window.addEventListener('online', () => {
            offlineIndicator.style.display = 'none';
        });

        window.addEventListener('offline', () => {
            offlineIndicator.style.display = 'block';
        });
    </script>
</body>
</html>